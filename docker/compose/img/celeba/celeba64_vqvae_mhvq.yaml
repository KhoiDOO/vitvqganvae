services:
  celeba64-vqvae-mhvq:
    build:
      context: ../../..
      dockerfile: docker/vqvae/img/celeba/celeba64_vqvae_mhvq.dockerfile
    image: vitvqganvae:celeba64_vqvae_mhvq
    shm_size: '32g'
    volumes:
      - ./.cache:/vitvqganvae/.cache
      - ./outputs:/vitvqganvae/outputs
    environment:
      - WANDB_API_KEY=${WANDB_API_KEY}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

networks:
  default:
    external: true
    name: vitvqganvae_network
